<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Clever Demo – Dashboard</title>
    <style>
      body {
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: #f5f7fb;
        margin: 0;
        padding: 20px;
        color: #1f2933;
      }

      .container {
        max-width: 1100px;
        margin: 0 auto;
      }

      .topbar {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 12px;
        margin-bottom: 16px;
      }

      .title h1 {
        margin: 0;
        font-size: 1.4rem;
      }

      .title p {
        margin: 6px 0 0 0;
        color: #6b7280;
        font-size: 0.95rem;
      }

      .card {
        background: #ffffff;
        border-radius: 12px;
        padding: 16px 18px;
        box-shadow: 0 10px 25px rgba(15, 23, 42, 0.08);
        margin-bottom: 16px;
      }

      .meta {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 10px;
        margin-top: 12px;
      }

      .pill {
        background: #f3f4f6;
        border-radius: 999px;
        padding: 8px 12px;
        font-size: 0.9rem;
        display: inline-flex;
        gap: 8px;
        align-items: center;
      }

      .pill b {
        color: #111827;
      }

      .role-pill {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        font-size: 0.75rem;
        font-weight: 700;
      }

      .role-student { background: #DBEAFE; color: #1D4ED8; }
      .role-teacher { background: #FEF3C7; color: #B45309; }
      .role-school_admin { background: #E5E7EB; color: #374151; }
      .role-district_admin { background: #DCFCE7; color: #166534; }
      .role-contact { background: #FCE7F3; color: #9D174D; }
      .role-unknown { background: #F3F4F6; color: #6B7280; }

      .role-switcher {
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        margin-top: 10px;
      }

      .role-switcher a {
        text-decoration: none;
        border: 1px solid #d1d5db;
        border-radius: 999px;
        padding: 6px 10px;
        font-size: 0.85rem;
        color: #111827;
        background: #fff;
      }

      .role-switcher a.active {
        border-color: #2F6C95;
        box-shadow: 0 0 0 2px rgba(47, 108, 149, 0.15);
      }

      .class-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 14px;
      }

      .class-card h3 {
        margin: 0 0 6px 0;
        font-size: 1rem;
      }

      .class-card p {
        margin: 0 0 10px 0;
        color: #6b7280;
        font-size: 0.9rem;
      }

      .list {
        margin: 0;
        padding-left: 18px;
        color: #111827;
        font-size: 0.9rem;
      }

      .empty {
        color: #6b7280;
        font-size: 0.95rem;
        margin: 0;
      }
    </style>
  </head>

  <body>
    <div class="container">

      <% const fullName = (dbUser && dbUser.name) ? dbUser.name : (user && user.name ? user.name : 'Unknown User'); %>
      <% const schoolNames = (Array.isArray(userSchools) && userSchools.length) ? userSchools.map(s => s.name).join(', ') : null; %>
      <% const hasMultipleRoles = Array.isArray(roles) && roles.length > 1; %>
      <% const active = activeRole || role || 'unknown'; %>
      <% const pretty = PrettyRole || active; %>

      <div class="topbar">
        <div class="title">
          <h1>Clever Demo – Dashboard</h1>
          <p>Signed in as <b><%= fullName %></b></p>
        </div>
      </div>

      <div class="card">
        <div class="meta">
          <div class="pill">
            <span>Role:</span>
            <span class="role-pill role-<%= active %>"><%= pretty %></span>
          </div>

          <% if (schoolNames) { %>
            <div class="pill">
              <span>Schools:</span>
              <b><%= schoolNames %></b>
            </div>
          <% } %>

          <div class="pill">
            <span>Classes:</span>
            <b><%= Array.isArray(classes) ? classes.length : 0 %></b>
          </div>
        </div>

        <% if (hasMultipleRoles) { %>
          <div class="role-switcher">
            <% roles.forEach(function(r) { %>
              <a href="/dashboard?role=<%= r %>" class="<%= (r === active) ? 'active' : '' %>">
                Act as: <%= r %>
              </a>
            <% }); %>
          </div>
        <% } %>
      </div>

      <div class="card">
        <h2 style="margin:0 0 12px 0; font-size:1.1rem;">Your Classes</h2>

        <% if (!Array.isArray(classes) || classes.length === 0) { %>
          <p class="empty">No classes found for this role.</p>
        <% } else { %>
          <div class="class-grid">
            <% classes.forEach(function(c) { %>
              <div class="card class-card" style="margin:0;">
                <h3><%= c.name %></h3>
                <% if (c.schoolName) { %>
                  <p><b><%= c.schoolName %></b></p>
                <% } %>

                <% if (Array.isArray(c.teachers) && c.teachers.length) { %>
                  <p style="margin-bottom:6px;"><b>Teachers</b></p>
                  <ul class="list">
                    <% c.teachers.forEach(function(t) { %>
                      <li><%= t.name %><% if (t.email) { %> (<%= t.email %>)<% } %></li>
                    <% }); %>
                  </ul>
                <% } %>

                <% if (Array.isArray(c.students) && c.students.length) { %>
                  <p style="margin:10px 0 6px 0;"><b>Students</b></p>
                  <ul class="list">
                    <% c.students.slice(0, 10).forEach(function(s) { %>
                      <li><%= s.name %><% if (s.email) { %> (<%= s.email %>)<% } %></li>
                    <% }); %>
                  </ul>
                  <% if (c.students.length > 10) { %>
                    <p style="margin:8px 0 0 0; color:#6b7280; font-size:0.85rem;">
                      Showing 10 of <%= c.students.length %> students
                    </p>
                  <% } %>
                <% } %>
              </div>
            <% }); %>
          </div>
        <% } %>
      </div>

    </div>
  </body>
</html>

